<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><span style="color:red">&lt;</span>Codegy<span style="color:red">&gt;</span></title>
  <link rel="stylesheet" href="vs/editor/editor.main.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #1e1e1e;
      color: #ddd;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
    }

    #toolbar-main {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      background: #2d2d2d;
      padding: 8px 10px;
      justify-content: center;
      align-items: center;
    }

    #toolbar-main button {
      background: #3a3a3a;
      border: none;
      color: #eee;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    #editor {
      flex: 1;
      height: 90vh;
      position: relative;
    }

    .logo-title {
      font-size: 22px;
      margin-right: 20px;
      color: #eee;
    }

    .logo-title span {
      color: red;
    }
  </style>

  <!-- تحميل مكتبة Monaco محليًا -->
  <script>
    var require = { paths: { vs: "vs" } };
  </script>
  <script src="vs/loader.js"></script>
</head>
<body>
  <div id="toolbar-main">
    <div class="logo-title"><span>&lt;</span>Codegy<span>&gt;</span></div>
    <button onclick="runCode()">Run</button>
    <button onclick="copyCode()">Copy</button>
    <button onclick="pasteCode()">Paste</button>
    <button onclick="undoCode()">Undo</button>
    <button onclick="redoCode()">Redo</button>
    <button onclick="clearCode()">Clear</button>
    <button onclick="shareCode()">Share</button>
  </div>

  <div id="editor"></div>

  <script>
    let editor;
    let lastValue = "";

    require(["vs/editor/editor.main"], function () {
      const saved = localStorage.getItem("codegy_html") || "<!DOCTYPE html>\\n<html><body><h1>Hello Codegy Offline!</h1></body></html>";
      editor = monaco.editor.create(document.getElementById("editor"), {
        value: saved,
        language: "html",
        theme: "vs-dark",
        automaticLayout: true
      });

      lastValue = saved;

      editor.onDidChangeModelContent(() => {
        localStorage.setItem("codegy_html", editor.getValue());
      });
    });

    function runCode() {
      const code = editor.getValue();
      const preview = window.open("", "_blank");
      preview.document.open();
      preview.document.write(code);
      preview.document.close();
    }

    function copyCode() {
      navigator.clipboard.writeText(editor.getValue()).then(() => alert("Copied!"));
    }

    function pasteCode() {
      navigator.clipboard.readText().then(text => editor.setValue(text));
    }

    function undoCode() {
      editor.trigger("keyboard", "undo", null);
    }

    function redoCode() {
      editor.trigger("keyboard", "redo", null);
    }

    function clearCode() {
      if (confirm("Are you sure you want to clear the code?")) {
        lastValue = editor.getValue();
        editor.setValue("");
      }
    }

    function shareCode() {
      const text = editor.getValue();
      if (navigator.share) {
        navigator.share({
          title: "Codegy",
          text: text,
          url: window.location.href
        }).catch(err => alert("Sharing failed: " + err));
      } else {
        alert("Sharing not supported on this browser.");
      }
    }
  </script>
</body>
</html>
