<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Code Editor</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css"/>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #282c34;
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .controls, .language-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
      background-color: #1e1e1e;
      flex-direction: row;
      flex-shrink: 0;
    }

    button {
      padding: 8px 14px;
      font-size: 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
      background-color: #2c2c2c;
      color: white;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.15);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background-color: #444;
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.3);
    }

    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #editor {
      height: 50vh;
    }

    .preview {
      height: 50vh;
      border-top: 2px solid #444;
      background-color: white;
    }
  </style>
</head>
<body>

  <!-- أزرار التحكم -->
  <div class="controls">
    <button onclick="updatePreview()"><i class="fas fa-play-circle"></i> تشغيل</button>
    <button onclick="copyCode()"><i class="fas fa-clipboard"></i> نسخ الكود</button>
    <button onclick="clearEditor()"><i class="fas fa-broom"></i> مسح</button>
    <button onclick="saveAs()"><i class="fas fa-floppy-disk"></i> حفظ</button>
    <button onclick="exportHTML()"><i class="fas fa-file-export"></i> تصدير HTML</button>
  </div>

  <!-- أزرار اللغات -->
  <div class="language-buttons">
    <button onclick="loadLesson('html')"><i class="fab fa-html5"></i> HTML</button>
    <button onclick="loadLesson('css')"><i class="fab fa-css3-alt"></i> CSS</button>
    <button onclick="loadLesson('javascript')"><i class="fab fa-js"></i> JavaScript</button>
    <button onclick="loadLesson('node')"><i class="fab fa-node-js"></i> Node</button>
  </div>

  <!-- المحرر والمعاينة -->
  <div class="editor-container">
    <textarea id="code"></textarea>
    <iframe class="preview"></iframe>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/xml-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/html-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/css-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/javascript-hint.min.js"></script>

  <script>
    const lessonsData = {
      html: [{ title: "Basic HTML", code: "<!DOCTYPE html>\n<html>\n<head>\n<title>My Page</title>\n</head>\n<body>\n<h1>Hello World!</h1>\n</body>\n</html>" }],
      css: [{ title: "Basic CSS", code: "body {\n  background-color: #f0f0f0;\n  font-family: Arial;\n}" }],
      javascript: [{ title: "Alert Example", code: "alert('Hello, JavaScript!');" }],
      node: [{ title: "Node Example", code: "console.log('Running in Node.js');" }]
    };

    let currentLang = 'html';

    const editor = CodeMirror.fromTextArea(document.getElementById('code'), {
      lineNumbers: true,
      theme: 'dracula',
      mode: 'htmlmixed',
      lineWrapping: true,
      autoCloseTags: true,
      extraKeys: {
        "Ctrl-Space": "autocomplete",
        "Tab": function(cm) {
          if (cm.state.completionActive) {
            cm.state.completionActive.pick();
          } else {
            cm.replaceSelection("  ");
          }
        },
        "Enter": function(cm) {
          if (cm.state.completionActive) {
            cm.state.completionActive.pick();
          } else {
            cm.execCommand("newlineAndIndent");
          }
        }
      },
      hintOptions: {
        completeSingle: false
      }
    });

    editor.on("keyup", function(cm, event) {
      const excludedKeys = ['Enter', 'Backspace', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'];
      if (!excludedKeys.includes(event.key) && !event.ctrlKey && !event.metaKey && !event.altKey) {
        cm.showHint();
      }
    });

    function loadLesson(lang) {
      currentLang = lang;
      const lesson = lessonsData[lang][0];
      editor.setValue(lesson.code);
      const mode = lang === 'html' ? 'htmlmixed' :
                   lang === 'css' ? 'css' :
                   'javascript';
      editor.setOption('mode', mode);
      updatePreview();
    }

    function updatePreview() {
      const code = editor.getValue();
      const iframe = document.querySelector('.preview');
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      const htmlContent =
        currentLang === 'css' ? `<style>${code}</style>` :
        currentLang === 'javascript' ? `<script>${code}<\/script>` :
        currentLang === 'node' ? `<pre>${code}</pre>` :
        code;
      doc.open();
      doc.write(htmlContent);
      doc.close();
    }

    function clearEditor() {
      editor.setValue('');
    }

    function saveAs() {
      const blob = new Blob([editor.getValue()], { type: "text/plain;charset=utf-8" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      const ext = currentLang === 'html' ? '.html' : currentLang === 'css' ? '.css' : '.js';
      a.download = `code${ext}`;
      a.click();
    }

    function exportHTML() {
      const code = editor.getValue();
      const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exported Code</title>
</head>
<body>
${code}
</body>
</html>`;
      const blob = new Blob([fullHTML], { type: "text/html;charset=utf-8" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "exported.html";
      a.click();
    }

    function copyCode() {
      navigator.clipboard.writeText(editor.getValue()).then(() => {
        alert("تم نسخ الكود");
      }).catch(err => {
        alert("حدث خطأ أثناء النسخ");
      });
    }

    // تحميل الدرس الأول عند بداية الصفحة
    loadLesson('html');
  </script>

</body>
</html>
