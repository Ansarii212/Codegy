<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Codegy â€“ Editor + Preview</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    html, body {
      margin:0; padding:0;
      width:100%; height:100%;
      background:#1e1e1e; color:#ddd;
      font-family:Arial,sans-serif;
      display:flex; flex-direction:column;
    }
    /* toolbars */
    #toolbar-main, #toolbar-langs {
      display:flex; flex-wrap:wrap; gap:8px;
      background:#2d2d2d; padding:8px 10px;
      z-index:10;
    }
    #toolbar-main button, #toolbar-langs button {
      background:#3a3a3a; border:none; color:#eee;
      padding:6px 12px; border-radius:4px;
      cursor:pointer; display:flex; align-items:center;
      gap:6px; transition:background .2s; outline:none;
      flex:1 1 auto;
      font-size:14px;
    }
    #toolbar-main button:hover,
    #toolbar-langs button:hover,
    #toolbar-langs button.active {
      background:#575757; color:#fff;
    }
    /* editor container */
    #container {
      flex:1; position:relative;
      display:flex; flex-direction:column;
    }
    #editor {
      flex:1; position:relative;
    }
    /* Monaco styling */
    .monaco-editor, .monaco-editor-background,
    .margin, .monaco-scrollable-element,
    .lines-content, .view-lines,
    .monaco-editor .inputarea.ime-input {
      border:none!important; box-shadow:none!important;
      outline:none!important; background:transparent!important;
    }
    .monaco-editor { background:#1e1e1e!important; }
    /* preview */
    #result-frame {
      position:absolute; top:0; left:0; right:0; bottom:0;
      width:100%; height:100%; border:none;
      background:white; display:none; z-index:5;
    }
    @media(max-width:600px){
      #toolbar-main button, #toolbar-langs button {
        font-size:12px; padding:5px 8px;
      }
    }
  </style>
</head>
<body>

  <div id="toolbar-main">
    <button id="btn-run"><i class="fas fa-play"></i> Run</button>
    <button id="btn-clear"><i class="fas fa-trash"></i> Clear</button>
    <button id="btn-save"><i class="fas fa-save"></i> Save</button>
    <button id="btn-export"><i class="fas fa-file-export"></i> Export</button>
    <button id="btn-select-all"><i class="fas fa-mouse-pointer"></i> Select All</button>
    <button id="btn-toggle"><i class="fas fa-columns"></i> Toggle View</button>
    <button id="btn-hide"><i class="fas fa-times"></i> Close</button>
  </div>

  <div id="toolbar-langs">
    <button id="lang-html" class="active">HTML</button>
    <button id="lang-css">CSS</button>
    <button id="lang-js">JavaScript</button>
  </div>

  <div id="container">
    <div id="editor"></div>
    <iframe id="result-frame" sandbox="allow-scripts"></iframe>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
  <script>
    require.config({ paths:{ vs:'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' }});
    let editor, currentLanguage='html', showingPreview=false;
    const examples = {
      html:`<!DOCTYPE html>\n<html><body><h1>Hello HTML!</h1></body></html>`,
      css:`body{background:lightgray;color:#333;}`,
      javascript:`console.log('Hello JS!');`
    };
    function getSaved(lang){
      return localStorage.getItem('codegy_'+lang) || examples[lang];
    }
    function autoSave(){
      localStorage.setItem('codegy_'+currentLanguage, editor.getValue());
    }
    require(['vs/editor/editor.main'], ()=>{
      editor = monaco.editor.create(document.getElementById('editor'),{
        value:getSaved(currentLanguage),
        language:currentLanguage,
        theme:'vs-dark',
        automaticLayout:true,
        minimap:{enabled:false},
        mouseWheelZoom:true,
        quickSuggestions:true,
        suggestOnTriggerCharacters:true,
        wordBasedSuggestions:true,
        contextmenu:false,
        lineNumbers:'on',
        renderLineHighlight:'none',
        fontSize:16
      });
      editor.onDidChangeModelContent(autoSave);
    });

    function showButtons(){
      document.querySelectorAll('#toolbar-main button').forEach(b=>b.style.display='inline-flex');
    }

    document.getElementById('btn-run').onclick=()=>{
      const code=editor.getValue();
      let content = currentLanguage==='html'? code
                  : currentLanguage==='css' ? `<style>${code}</style>`
                  : `<script>${code}<\/script>`;
      const pf=document.getElementById('result-frame');
      pf.srcdoc=content; pf.style.display='block';
      showingPreview=true;
      editor.layout(); editor.focus();
      showButtons();
    };

    document.getElementById('btn-hide').onclick=()=>{
      document.getElementById('result-frame').style.display='none';
      showingPreview=false;
      editor.layout(); editor.focus();
      showButtons();
    };

    document.getElementById('btn-clear').onclick=()=>{
      editor.setValue(''); autoSave();
    };

    document.getElementById('btn-save').onclick=()=>{
      autoSave(); alert('Saved');
    };

    document.getElementById('btn-export').onclick=()=>{
      if(currentLanguage!=='html') return alert('Export only HTML');
      const blob=new Blob([editor.getValue()],{type:'text/html'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='export.html'; a.click();
    };

    document.getElementById('btn-select-all').onclick=()=>{
      editor.setSelection(editor.getModel().getFullModelRange());
    };

    document.getElementById('btn-toggle').onclick=()=>{
      showingPreview
        ? document.getElementById('btn-hide').click()
        : document.getElementById('btn-run').click();
    };

    document.querySelectorAll('#toolbar-langs button').forEach(btn=>{
      btn.onclick=()=>{
        document.querySelectorAll('#toolbar-langs button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        currentLanguage = btn.id==='lang-js'?'javascript':btn.id.replace('lang-','');
        monaco.editor.setModelLanguage(editor.getModel(),currentLanguage);
        editor.setValue(getSaved(currentLanguage));
        autoSave();
        if(showingPreview) document.getElementById('btn-run').click();
      };
    });
  </script>
</body>
</html>
